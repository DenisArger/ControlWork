from __future__ import annotations

TEXTS = {
    "en": {
        "app_title": "ControlWork",
        "menu_status": "Status",
        "menu_pause": "Pause",
        "menu_resume": "Resume",
        "menu_stats": "Statistics",
        "menu_settings": "Settings",
        "menu_exit": "Exit",
        "state_active": "Active",
        "state_idle": "Idle",
        "state_break": "Break",
        "state_paused": "Paused",
        "tab_status": "Status",
        "tab_settings": "Settings",
        "tab_stats": "Statistics",
        "status_title": "Current state",
        "today_active": "Active today",
        "today_idle": "Idle today",
        "today_break": "Break today",
        "today_snooze": "Snoozes today",
        "today_skip": "Skips today",
        "settings_language": "Language",
        "settings_autostart": "Start with system",
        "settings_idle": "Idle threshold (sec)",
        "settings_break": "Break duration (min)",
        "settings_tone": "Reminder tone",
        "settings_soft": "Soft points (min, comma)",
        "settings_hard": "Hard points (min, comma)",
        "settings_reset": "Workday reset (HH:MM)",
        "settings_save": "Save settings",
        "saved_ok": "Settings saved",
        "btn_snooze": "Snooze 5 min",
        "btn_ignore": "Ignore",
        "overlay_start": "Start break now",
        "overlay_skip": "Skip",
        "overlay_snooze": "Snooze 5 min",
        "overlay_remaining": "Remaining: {seconds}s",
        "overlay_idle": "Idle streak: {seconds}s / 120s",
        "limit_snooze": "Snooze limit reached (2 per work hour)",
        "limit_skip": "Skip limit reached (1 per day)",
        "first_run_title": "Initial setup",
        "first_run_apply": "Apply",
        "first_run_soft_hint": "Example: 15,30,45",
        "first_run_hard_hint": "Example: 50",
        "parse_error": "Cannot parse points list",
        "tone_friendly": "Friendly",
        "tone_care": "Caring",
        "tone_neutral": "Neutral",
        "tone_motivation": "Motivational",
        "tone_short": "Short",
    },
    "ru": {
        "app_title": "ControlWork",
        "menu_status": "Статус",
        "menu_pause": "Пауза",
        "menu_resume": "Продолжить",
        "menu_stats": "Статистика",
        "menu_settings": "Настройки",
        "menu_exit": "Выход",
        "state_active": "Работа",
        "state_idle": "Нет активности",
        "state_break": "Перерыв",
        "state_paused": "Пауза",
        "tab_status": "Статус",
        "tab_settings": "Настройки",
        "tab_stats": "Статистика",
        "status_title": "Текущее состояние",
        "today_active": "Активно сегодня",
        "today_idle": "Неактивно сегодня",
        "today_break": "Перерыв сегодня",
        "today_snooze": "Отложено сегодня",
        "today_skip": "Пропусков сегодня",
        "settings_language": "Язык",
        "settings_autostart": "Запускать с системой",
        "settings_idle": "Порог idle (сек)",
        "settings_break": "Длительность перерыва (мин)",
        "settings_tone": "Стиль напоминаний",
        "settings_soft": "Мягкие точки (мин, через запятую)",
        "settings_hard": "Строгие точки (мин, через запятую)",
        "settings_reset": "Сброс рабочего дня (ЧЧ:ММ)",
        "settings_save": "Сохранить настройки",
        "saved_ok": "Настройки сохранены",
        "btn_snooze": "Отложить 5 мин",
        "btn_ignore": "Игнорировать",
        "overlay_start": "Начать перерыв",
        "overlay_skip": "Пропустить",
        "overlay_snooze": "Отложить 5 мин",
        "overlay_remaining": "Осталось: {seconds}с",
        "overlay_idle": "Idle-серия: {seconds}с / 120с",
        "limit_snooze": "Лимит отложений исчерпан (2 в рабочий час)",
        "limit_skip": "Лимит пропусков исчерпан (1 в день)",
        "first_run_title": "Первичная настройка",
        "first_run_apply": "Применить",
        "first_run_soft_hint": "Например: 15,30,45",
        "first_run_hard_hint": "Например: 50",
        "parse_error": "Не удалось разобрать список точек",
        "tone_friendly": "Дружелюбный",
        "tone_care": "Заботливый",
        "tone_neutral": "Нейтральный",
        "tone_motivation": "Мотивационный",
        "tone_short": "Короткий",
    },
}


TONE_MESSAGE_KEYS = {
    "soft_title",
    "soft_body",
    "soft_dialog",
    "hard_title",
    "hard_body",
    "overlay_prompt",
    "break_done",
}


TONE_TEXTS = {
    "ru": {
        "friendly": {
            "soft_title": "Пора размяться",
            "soft_body": "Вы уже {minutes} минут в фокусе. Небольшой перерыв пойдет на пользу.",
            "soft_dialog": "Сделаем короткую паузу?",
            "hard_title": "Время обязательного перерыва",
            "hard_body": "Вы долго работаете без паузы. Давайте сейчас отдохнем.",
            "overlay_prompt": "Время остановиться и передохнуть",
            "break_done": "Отлично, перерыв завершен",
        },
        "care": {
            "soft_title": "Бережем энергию",
            "soft_body": "{minutes} минут работы подряд. Пора дать глазам и спине отдых.",
            "soft_dialog": "Небольшая пауза сейчас поможет работать легче дальше.",
            "hard_title": "Нужен перерыв",
            "hard_body": "Порог непрерывной работы достигнут. Давайте переключимся на отдых.",
            "overlay_prompt": "Сделайте паузу для восстановления",
            "break_done": "Вы восстановились, можно продолжать",
        },
        "neutral": {
            "soft_title": "Напоминание о паузе",
            "soft_body": "Активная работа: {minutes} минут.",
            "soft_dialog": "Рекомендуется сделать короткий перерыв.",
            "hard_title": "Обязательный перерыв",
            "hard_body": "Достигнут максимальный интервал без отдыха.",
            "overlay_prompt": "Начните перерыв сейчас",
            "break_done": "Перерыв засчитан",
        },
        "motivation": {
            "soft_title": "Отличный темп",
            "soft_body": "Уже {minutes} минут продуктивной работы. Пауза поможет сохранить темп.",
            "soft_dialog": "Отдохнем 5-10 минут и вернемся сильнее?",
            "hard_title": "Перезагрузка обязательна",
            "hard_body": "Чтобы сохранить концентрацию, нужен перерыв прямо сейчас.",
            "overlay_prompt": "Время на перезагрузку",
            "break_done": "Супер, перерыв выполнен",
        },
        "short": {
            "soft_title": "Пауза?",
            "soft_body": "{minutes} минут без остановки.",
            "soft_dialog": "Сделаем короткий перерыв.",
            "hard_title": "Стоп, отдых",
            "hard_body": "Пора сделать обязательную паузу.",
            "overlay_prompt": "Сейчас перерыв",
            "break_done": "Готово, продолжаем",
        },
    },
    "en": {
        "friendly": {
            "soft_title": "Time to stretch",
            "soft_body": "You have stayed focused for {minutes} minutes. A short break will help.",
            "soft_dialog": "Want to take a short pause now?",
            "hard_title": "Mandatory break time",
            "hard_body": "You have worked for a long stretch. Let's take a break now.",
            "overlay_prompt": "Time to pause and recharge",
            "break_done": "Great, break completed",
        },
        "care": {
            "soft_title": "Protect your energy",
            "soft_body": "{minutes} minutes in a row. Give your eyes and back some rest.",
            "soft_dialog": "A short pause now will make the next block easier.",
            "hard_title": "Break needed",
            "hard_body": "Continuous work threshold reached. Please switch to rest.",
            "overlay_prompt": "Take a recovery pause",
            "break_done": "Recovered, ready to continue",
        },
        "neutral": {
            "soft_title": "Break reminder",
            "soft_body": "Active work: {minutes} minutes.",
            "soft_dialog": "A short break is recommended.",
            "hard_title": "Mandatory break",
            "hard_body": "Maximum uninterrupted work interval reached.",
            "overlay_prompt": "Start break now",
            "break_done": "Break counted",
        },
        "motivation": {
            "soft_title": "Great momentum",
            "soft_body": "{minutes} minutes of productive work. A pause will protect your pace.",
            "soft_dialog": "Take 5-10 minutes and come back stronger?",
            "hard_title": "Reset required",
            "hard_body": "To keep high focus, start a break now.",
            "overlay_prompt": "Time to reset",
            "break_done": "Nice, break complete",
        },
        "short": {
            "soft_title": "Pause?",
            "soft_body": "{minutes} minutes nonstop.",
            "soft_dialog": "Let's do a short break.",
            "hard_title": "Stop, rest",
            "hard_body": "Mandatory pause time.",
            "overlay_prompt": "Break now",
            "break_done": "Done, continue",
        },
    },
}


def tr(lang: str, key: str, **kwargs: object) -> str:
    tone = str(kwargs.pop("_tone", "friendly"))
    lang_key = "en" if lang == "en" else "ru"

    text = None
    if key in TONE_MESSAGE_KEYS:
        text = TONE_TEXTS.get(lang_key, {}).get(tone, {}).get(key)
        if text is None:
            text = TONE_TEXTS.get(lang_key, {}).get("friendly", {}).get(key)

    if text is None:
        text = TEXTS.get(lang_key, TEXTS["ru"]).get(key, key)

    if kwargs:
        return text.format(**kwargs)
    return text
